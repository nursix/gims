/*
 2025 (c) Sahana Software Foundation
 @license MIT
*/
(function(a,m){var k=0;a.widget("s3.variableColumns",{options:{},_create:function(){this.id=k;k+=1;this.eventNamespace=".variableColumns"},_init:function(){const d=a(this.element).closest("form.dt-wrapper");this.availableColumns=a(".column-selector",d);this.refresh()},_destroy:function(){},refresh:function(){this._unbindEvents();this._bindEvents()},_openDialog:function(){const d=this.availableColumns;if(d.length){var f=a("<div>").hide().appendTo(a("body")),e=document.createElement("form"),c=a(e).appendTo(f),
b=this.eventNamespace,l=this;e.method="post";e.enctype="multipart/form-data";d.first().clone().removeClass("hide").show().appendTo(c);var h=f.show().dialog({title:i18n.selectColumns,autoOpen:!1,minHeight:480,maxHeight:640,minWidth:320,modal:!0,closeText:"",open:function(){a(".ui-widget-overlay").off(b).on("click"+b,function(){h.dialog("close")});a(".cancel-form-btn",c).off(b).on("click"+b,function(){h.dialog("close")});a(".submit-form-btn",c).off(b).on("click"+b,function(){a(".column-select:checked",
f).length&&(l._applyColumnSelection(e),h.dialog("close"))});a(".reset-form-btn",c).off(b).on("click"+b,function(){l._applyColumnSelection(e,!0)});a(".column-options",c).sortable({placeholder:"sortable-placeholder",forcePlaceholderSize:!0});a(".column-left",c).off(b).on("click"+b,function(){const g=a(this).closest("tr");g.insertBefore(g.prev())});a(".column-right",c).off(b).on("click"+b,function(){const g=a(this).closest("tr");g.insertAfter(g.next())});a(".column-select-all",c).off(b).on("change"+
b,function(){let g=a(this).prop("checked");a(".column-select",c).prop("checked",g)});a(".column-select",c).off(b).on("change"+b,function(){let g=a(".column-select:not(:checked)",f).length;a(".column-select-all",c).prop("checked",!g)})},close:function(){a(".column-options",c).sortable("destroy");f.hide().remove()}});h.dialog("open")}},_applyColumnSelection:function(d,f){const e=document.createElement("a");e.href=window.location.href;const c=new URLSearchParams(e.search);c.delete("aCols");if(!f){const b=
[];a(".column-select:checked",d).each(function(){b.push(a(this).data("index"))});b.length&&c.append("aCols",b.join(","))}e.search=c.toString();window.location.href=e.href},_bindEvents:function(){const d=this,f=this.eventNamespace;a(this.element).on("click"+f,function(){d._openDialog()});return!0},_unbindEvents:function(){const d=this.eventNamespace;a(this.element).off(d);return!0}})})(jQuery);
